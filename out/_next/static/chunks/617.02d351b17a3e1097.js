"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[617],{48434:function(e,n,t){t.r(n),t.d(n,{default:function(){return ex}});var r,s,i,a,c,l=t(50029),o=t(87794),d=t.n(o),u=t(9008),x=t.n(u),f=t(41664),m=t.n(f),h=t(31407),v=t(67294),p=t(11163),g=t(85893),b=function(e){var n=e.children,t="/"===(0,p.useRouter)().pathname;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(h.u.Root,{show:t,as:v.Fragment,children:(0,g.jsx)("div",{className:"fixed inset-0 flex bg-white md:hidden",children:(0,g.jsx)(h.u.Child,{as:v.Fragment,enter:"transition ease-in-out duration-300 transform",enterFrom:"-translate-x-full",enterTo:"translate-x-0",leave:"transition ease-in-out duration-300 transform",leaveFrom:"translate-x-0",leaveTo:"-translate-x-full",children:(0,g.jsx)("div",{className:"relative flex-1 flex flex-col w-full bg-white",children:n})})})}),(0,g.jsx)("div",{className:"hidden md:flex",children:n})]})},j=function(e){var n=e.children,t="/"!==(0,p.useRouter)().pathname;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(h.u.Root,{show:t,as:v.Fragment,children:(0,g.jsx)("div",{className:"md:hidden inset-0 flex flex-col h-screen bg-white ",children:(0,g.jsx)(h.u.Child,{as:v.Fragment,enter:"transition ease-in-out duration-300 transform",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transition ease-in-out duration-300 transform",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:(0,g.jsx)("div",{className:"md:hidden relative flex-1 flex flex-col w-full",children:n})})})}),(0,g.jsx)("div",{className:"hidden md:bg-white md:pl-84 md:flex md:flex-col md:flex-1 md:h-screen",children:n})]})},w=t(70224),y=function(){var e=(0,p.useRouter)();return(0,g.jsx)("button",{className:"inline-flex items-center h-7 md:h-6 px-4 py-1 my-4 bg-p-400 border border-p-300 hover:bg-p-300 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-n-100 focus-visible:ring-offset-p-600 focus-visible:border-n-100 focus-visible:outline-none active:bg-p-500 active:border-p-500 active:ring-0 text-sm md:text-xs md:font-semibold tracking-wide text-white rounded",onClick:function(){e.push("/dm/")},children:"+ New Message"})},N=t(77082),k=t(4664),C=t(98519),A=t(66293),q=t(61622),Z=t(21321),M=t(39631),T=function(e){var n,t,r=e.conversation,s=(0,p.useRouter)(),i=(0,C.q)(function(e){return e.address}),a=(0,C.q)(function(e){return e.previewMessages}),c=(0,C.q)(function(e){return e.loadingConversations}),l=(0,v.useState)(),o=l[0],d=l[1];if((0,v.useEffect)(function(){var e;d(null!==(e=Array.isArray(s.query.recipientWalletAddr)?s.query.recipientWalletAddr.join("/"):s.query.recipientWalletAddr)&&void 0!==e?e:"")},[s.query.recipientWalletAddr]),(0,v.useEffect)(function(){!o&&window.location.pathname.includes("/dm")&&(s.push(window.location.pathname),d(window.location.pathname.replace("/dm/","")))},[o,window.location.pathname]),!a.get((0,Z.n2)(r)))return null;var u=a.get((0,Z.n2)(r)),x=null!==(n=null===(t=r.context)||void 0===t?void 0:t.conversationId.split("/")[0])&&void 0!==n?n:"",f=o===(0,Z.n2)(r);if(!u)return null;var m=function(e){s.push(e)};return(0,g.jsxs)("div",{onClick:function(){return m("/dm/".concat((0,Z.n2)(r)))},className:(0,Z.AK)("h-20","py-2","px-4","md:max-w-sm","mx-auto","bg-white","space-y-2","py-2","flex","items-center","space-y-0","space-x-4","border-b-2","border-gray-100","hover:bg-bt-100","cursor-pointer",c?"opacity-80":"opacity-100",f?"bg-bt-200":null),children:[(0,g.jsx)(M.Z,{peerAddress:r.peerAddress}),(0,g.jsxs)("div",{className:"py-4 sm:text-left text w-full",children:[x&&(0,g.jsx)("div",{className:"text-sm rounded-2xl text-white bg-black w-max px-2 font-bold",children:x.toLocaleUpperCase()}),(0,g.jsxs)("div",{className:"grid-cols-2 grid",children:[(0,g.jsx)(q.Z,{address:r.peerAddress,className:"text-black text-lg md:text-md font-bold place-self-start"}),(0,g.jsx)("span",{className:(0,Z.AK)("text-lg md:text-sm font-normal place-self-end",f?"text-n-500":"text-n-300",c?"animate-pulse":""),children:(0,Z.p6)(null==u?void 0:u.sent)})]}),(0,g.jsxs)("span",{className:"text-sm text-gray-500 line-clamp-1 break-all",children:[i===(null==u?void 0:u.senderAddress)&&"You: "," ",null==u?void 0:u.content]})]})]})},O=function(){return(0,g.jsx)("div",{className:"flex flex-col flex-grow justify-center h-[100%]",children:(0,g.jsxs)("div",{className:"flex flex-col items-center px-4 text-center",children:[(0,g.jsx)(A.Z,{className:"h-8 w-8 mb-1 stroke-n-200 md:stroke-n-300","aria-hidden":"true"}),(0,g.jsx)("p",{className:"text-xl md:text-lg text-n-200 md:text-n-300 font-bold",children:"Your message list is empty"}),(0,g.jsx)("p",{className:"text-lx md:text-md text-n-200 font-normal",children:"There are no messages for this address"})]})})},F=v.memo(function(){var e=(0,C.q)(function(e){return e.conversations}),n=(0,C.q)(function(e){return e.previewMessages});return e&&0!=e.size?(0,g.jsx)(g.Fragment,{children:e&&e.size>0&&Array.from(e.values()).sort(function(e,t){var r,s;return((null===(r=n.get((0,Z.n2)(e)))||void 0===r?void 0:r.sent)||new Date)<((null===(s=n.get((0,Z.n2)(t)))||void 0===s?void 0:s.sent)||new Date)?1:-1}).map(function(e){return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(T,{conversation:e},(0,Z.n2)(e))})})}):(0,g.jsx)(O,{})}),E=t(36121);function z(){return(z=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var S=function(e){return v.createElement("svg",z({xmlns:"http://www.w3.org/2000/svg",height:"1em",style:{fill:"#7269ef"},viewBox:"0 0 640 512",width:"1em"},e),r||(r=v.createElement("path",{d:"M208 352c114.9 0 208-78.8 208-176S322.9 0 208 0 0 78.8 0 176c0 38.6 14.7 74.3 39.6 103.4-3.5 9.4-8.7 17.7-14.2 24.7-4.8 6.2-9.7 11-13.3 14.3-1.8 1.6-3.3 2.9-4.3 3.7-.5.4-.9.7-1.1.8l-.2.2C1 327.2-1.4 334.4.8 340.9S9.1 352 16 352c21.8 0 43.8-5.6 62.1-12.5 9.2-3.5 17.8-7.4 25.3-11.4C134.1 343.3 169.8 352 208 352zm240-176c0 112.3-99.1 196.9-216.5 207 24.3 74.4 104.9 129 200.5 129 38.2 0 73.9-8.7 104.7-23.9 7.5 4 16 7.9 25.2 11.4 18.3 6.9 40.3 12.5 62.1 12.5 6.9 0 13.1-4.5 15.2-11.1 2.1-6.6-.2-13.8-5.8-17.9l-.2-.2c-.2-.2-.6-.4-1.1-.8-1-.8-2.5-2-4.3-3.7-3.6-3.3-8.5-8.1-13.3-14.3-5.5-7-10.7-15.4-14.2-24.7 24.9-29 39.6-64.7 39.6-103.4 0-92.8-84.9-168.9-192.6-175.5.4 5.1.6 10.3.6 15.5z"})))};function P(){return(P=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var I=function(e){return v.createElement("svg",P({xmlns:"http://www.w3.org/2000/svg",height:"1em",style:{fill:"#7269ef"},viewBox:"0 0 448 512",width:"1em"},e),s||(s=v.createElement("path",{d:"M304 128a80 80 0 1 0-160 0 80 80 0 1 0 160 0zm-208 0a128 128 0 1 1 256 0 128 128 0 1 1-256 0zM49.3 464h349.4c-8.9-63.3-63.3-112-129-112h-91.4c-65.7 0-120.1 48.7-129 112zM0 482.3C0 383.8 79.8 304 178.3 304h91.4c98.5 0 178.3 79.8 178.3 178.3 0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3z"})))};function H(){return(H=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var D=function(e){return v.createElement("svg",H({xmlns:"http://www.w3.org/2000/svg",height:"1em",style:{fill:"#7269ef"},viewBox:"0 0 640 512",width:"1em"},e),i||(i=v.createElement("path",{d:"M96 128a128 128 0 1 1 256 0 128 128 0 1 1-256 0zM0 482.3C0 383.8 79.8 304 178.3 304h91.4c98.5 0 178.3 79.8 178.3 178.3 0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM609.3 512H471.4c5.4-9.4 8.6-20.3 8.6-32v-8c0-60.7-27.1-115.2-69.8-151.8 2.4-.1 4.7-.2 7.1-.2h61.4c89.1 0 161.3 72.2 161.3 161.3 0 17-13.8 30.7-30.7 30.7zM432 256c-31 0-59-12.6-79.3-32.9 19.7-26.6 31.3-59.5 31.3-95.1 0-26.8-6.6-52.1-18.3-74.3C384.3 40.1 407.2 32 432 32c61.9 0 112 50.1 112 112s-50.1 112-112 112z"})))};function K(){return(K=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var L=function(e){return v.createElement("svg",K({xmlns:"http://www.w3.org/2000/svg",height:"1em",style:{fill:"#7269ef"},viewBox:"0 0 512 512",width:"1em"},e),a||(a=v.createElement("path",{d:"M495.9 166.6c3.2 8.7.5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4l-55.6 17.8c-8.8 2.8-18.6.3-24.5-6.8-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4c-1.1-8.4-1.7-16.9-1.7-25.5s.6-17.1 1.7-25.4l-43.3-39.4c-6.9-6.2-9.6-15.9-6.4-24.6 4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2 5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8 8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"})))},R=function(e){var n=e.children;return(0,g.jsxs)("div",{className:"flex flex-col flex-grow justify-center",children:[(0,g.jsxs)("div",{className:"flex flex-col items-center px-4 text-center",children:[(0,g.jsx)(N.Z,{className:"h-8 w-8 mb-1 stroke-n-200 md:stroke-n-300","aria-hidden":"true"}),(0,g.jsx)("p",{className:"text-xl md:text-lg text-n-200 md:text-n-300 font-bold",children:"No wallet connected"}),(0,g.jsx)("p",{className:"text-lx md:text-md text-n-200 font-normal",children:"Please connect a wallet to begin"})]}),n]})},B=function(e){var n=e.onConnect;return(0,g.jsx)("button",{onClick:n,className:"rounded border border-l-300 mx-auto my-4 text-l-300 hover:text-white hover:bg-l-400 hover:border-l-400 hover:fill-white focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-n-100 focus-visible:outline-none active:bg-l-500 active:border-l-500 active:text-l-100 active:ring-0",children:(0,g.jsxs)("div",{className:"flex items-center justify-center text-xs font-semibold px-4 py-1",children:["Connect your wallet",(0,g.jsx)(k.Z,{className:"h-4"})]})})},U=function(){var e=(0,C.q)(function(e){return e.client}),n=(0,C.q)(function(e){return e.loadingConversations});return void 0===e?(0,g.jsx)(E.ZP,{headingText:"Awaiting signatures...",subHeadingText:"Use your wallet to sign",isLoading:!0}):n?(0,g.jsx)(E.ZP,{headingText:"Loading conversations...",subHeadingText:"Please wait a moment",isLoading:!0}):(0,g.jsx)("nav",{className:"flex-1 pb-4",children:(0,g.jsxs)("div",{style:{display:"flex",overflow:"none"},children:[(0,g.jsxs)("div",{style:{boxShadow:"6px 0px 10px -3px rgba(0,0,0,0.1)",width:"70px",zIndex:"1",height:"80.6vh",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[(0,g.jsx)(S,{className:"text-2xl mb-5 "}),(0,g.jsx)(I,{className:"text-2xl mb-5"}),(0,g.jsx)(D,{className:"text-2xl mb-5"}),(0,g.jsx)(L,{className:"text-2xl"})]}),(0,g.jsx)("div",{style:{backgroundColor:"#F5F7FB",height:"80.6vh"},children:(0,g.jsx)(F,{})})]})})},_=function(e){var n=e.onConnect,t=(0,C.q)(function(e){return e.address}),r=(0,C.q)(function(e){return e.client});return(0,g.jsx)("div",{className:"flex-grow flex flex-col h-[calc(100vh-8rem)] overflow-y-auto",children:t&&null!==r?(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(U,{})}):(0,g.jsx)(R,{children:(0,g.jsx)(B,{onConnect:n})})})},W=t(51183),G=t(4564),V=function(e){var n=e.icon,t=e.headingText,r=e.onClick,s=e.disabled;return(0,g.jsx)("a",{onClick:s?void 0:r,className:s?"cursor-auto":"cursor-pointer",children:(0,g.jsxs)("div",{className:(0,Z.AK)(s?"opacity-40":"","flex py-4 border border-x-0 border-y-zinc-50 justify-between items-stretch text-left"),children:[(0,g.jsx)("div",{className:"h-10 w-10 bg-l-300 rounded-lg text-white p-2",children:n}),(0,g.jsx)("div",{className:"ml-3 flex-col justify-center text-md flex-1",children:(0,g.jsx)("div",{className:"font-semibold text-n-600 pt-2",children:t})}),(0,g.jsx)("div",{className:"w-10 flex justify-end items-center pr-2",children:(0,g.jsx)(W.Z,{className:"h-5"})})]})})},X=function(e){var n=e.onConnect,t=(0,C.q)(function(e){return e.address}),r=[{icon:(0,g.jsx)(G.Z,{}),headingText:"Connect your wallet",subHeadingText:"",onClick:n,disabled:!!t}];return(0,g.jsxs)("div",{className:"hidden md:block   m-auto w-[464px]",children:[(0,g.jsxs)("div",{className:"pb-6",children:[(0,g.jsx)("div",{className:"text-xl text-n-600 font-semibold mb-1",children:"Connect the Wallet"}),(0,g.jsx)("div",{className:"text-md text-n-300",children:"Get started by reading the docs or joining the community"})]}),(0,g.jsx)("div",{children:r.map(function(e,n){return(0,g.jsx)(V,{icon:e.icon,headingText:e.headingText,subHeadingText:e.subHeadingText,onClick:e.onClick,disabled:e.disabled},n)})})]})},Y=t(74014),$=t(22659),J=t(30710),Q=t(19308),ee=function(e){var n=e.walletAddress,t=(0,Q.Z)(n),r=t.avatarUrl;return t.loading?(0,g.jsx)("div",{className:"animate-pulse flex",children:(0,g.jsx)("div",{className:"rounded-full bg-n-200 h-8 w-8 mr-2"})}):r?(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"rounded-full w-8 h-8 mr-2 border border-n-80"}),(0,g.jsx)("img",{className:"rounded-full h-8 w-8 -mt-8",src:r,alt:n})]}):(0,g.jsx)(J.Z,{seed:n.toLowerCase(),scale:4,size:8,className:"rounded-full mr-2"})},en=function(e){var n=e.onConnect;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{className:"flex items-center",children:[(0,g.jsx)("div",{className:"bg-y-100 rounded-full h-2 w-2 mr-1"}),(0,g.jsx)("p",{className:"text-sm font-bold text-y-100",children:"You are not connected."})]}),(0,g.jsx)("a",{onClick:n,children:(0,g.jsx)("p",{className:"text-sm font-normal text-y-100 hover:text-y-200 ml-3 cursor-pointer",children:"Sign in with your wallet"})})]}),(0,g.jsxs)("button",{className:"max-w-xs flex items-center text-sm rounded focus:outline-none",onClick:n,children:[(0,g.jsx)("span",{className:"sr-only",children:"Connect"}),(0,g.jsx)($.Z,{className:"h-6 w-6 md:h-5 md:w-5 fill-n-100 hover:fill-n-200","aria-hidden":"true"})]})]})},et=function(e){var n=e.onConnect,t=e.onDisconnect,r=(0,C.q)(function(e){return e.address}),s=function(){r&&navigator.clipboard.writeText(r)};return(0,g.jsx)("div",{className:"flex ".concat((0,Z.HH)()?"bg-p-600":"bg-n-500"," items-center justify-between rounded-lg max-h-16 min-h-[4rem] px-4 py-2 m-2 mt-0 drop-shadow-xl"),children:r?(0,g.jsx)(Y.v,{children:function(e){var n=e.open;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:(0,Z.AK)(n?"opacity-75":"","flex items-center"),children:r?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(ee,{walletAddress:r}),(0,g.jsxs)("div",{className:"flex flex-col",children:[(0,g.jsxs)("div",{className:"flex items-center",children:[(0,g.jsx)("div",{className:"bg-g-100 rounded h-2 w-2 mr-1"}),(0,g.jsx)("p",{className:"text-sm font-bold text-g-100",children:"Connected as:"})]}),(0,g.jsx)(q.Z,{address:r,className:"text-md leading-4 font-semibold text-white ml-3"})]})]}):(0,g.jsxs)("div",{className:"h-14 flex flex-col flex-1 justify-center",children:[(0,g.jsxs)("div",{className:"flex items-center",children:[(0,g.jsx)("div",{className:"bg-p-100 rounded h-2 w-2 mr-1"}),(0,g.jsx)("p",{className:"text-sm font-bold text-p-100",children:"Connecting..."})]}),(0,g.jsx)("p",{className:"text-sm font-normal text-p-100 ml-3",children:"Verifying your wallet"})]})}),(0,g.jsxs)("div",{className:"flex items-center",children:[(0,g.jsx)("div",{children:(0,g.jsxs)(Y.v.Button,{className:"max-w-xs flex items-center text-sm rounded-full focus:outline-none",children:[(0,g.jsx)("span",{className:"sr-only",children:"Open user menu"}),(0,g.jsx)($.Z,{className:(0,Z.AK)(n?"fill-white":"","h-6 w-6 md:h-5 md:w-5 fill-n-100 hover:fill-n-200"),"aria-hidden":"true"})]})}),(0,g.jsx)(h.u,{as:v.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,g.jsxs)(Y.v.Items,{className:"origin-bottom-right absolute right-0 bottom-12 mb-4 w-40 rounded-md shadow-lg bg-white divide-y-2 divide-zinc-50 ring-1 ring-black ring-opacity-5 focus:outline-none",children:[(0,g.jsx)("div",{className:"px-1 py-1 ",children:(0,g.jsx)(Y.v.Item,{children:function(e){var n=e.active;return(0,g.jsx)("a",{onClick:s,className:(0,Z.AK)(n?"bg-zinc-50":"","block rounded-md px-2 py-2 text-sm text-n-600 text-right font-normal cursor-pointer"),children:"Copy wallet address"})}})}),(0,g.jsx)("div",{className:"px-1 py-1 ",children:(0,g.jsx)(Y.v.Item,{children:function(e){var n=e.active;return(0,g.jsx)("a",{onClick:t,className:(0,Z.AK)(n?"bg-zinc-50 cursor-pointer":"","block rounded-md px-2 py-2 text-sm text-l-300 text-right font-semibold"),children:"Disconnect wallet"})}})})]})})]})]})}}):(0,g.jsx)(en,{onConnect:n})})},er=t(4346),es=function(){var e,n,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=(0,C.q)(function(e){return e.signer}),s=null!==(n=(0,C.q)(function(e){return e.address}))&&void 0!==n?n:"",i=(0,C.q)(function(e){return e.client}),a=(0,C.q)(function(e){return e.setClient}),c=(0,C.q)(function(e){return e.reset}),o=(0,v.useState)(!1),u=o[0],x=o[1],f=function(){c(),r&&(0,Z.xO)(s)},m=(0,v.useCallback)((e=(0,l.Z)(d().mark(function e(n){var r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n&&!i)){e.next=23;break}if(e.prev=1,x(!0),r=(0,Z.XS)(s)){e.next=11;break}if(!t){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,er.Client.getKeys(n,{env:(0,Z.dU)(),appVersion:(0,Z.Sf)()});case 9:r=e.sent,(0,Z.us)(s,r);case 11:return e.next=13,er.Client.create(null,{env:(0,Z.dU)(),appVersion:(0,Z.Sf)(),privateKeyOverride:r});case 13:a(e.sent),x(!1),e.next=23;break;case 18:e.prev=18,e.t0=e.catch(1),console.error(e.t0),a(null),x(!1);case 23:case"end":return e.stop()}},e,null,[[1,18]])})),function(n){return e.apply(this,arguments)}),[i]);return(0,v.useEffect)(function(){u||(r?m(r):f())},[r,m]),{initClient:m}},ei=t(76687),ea=t(18587);function ec(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function el(e){var n,t,r,s=2;for("undefined"!=typeof Symbol&&(t=Symbol.asyncIterator,r=Symbol.iterator);s--;){if(t&&null!=(n=e[t]))return n.call(e);if(r&&null!=(n=e[r]))return new eo(n.call(e));t="@@asyncIterator",r="@@iterator"}throw TypeError("Object is not async iterable")}function eo(e){function n(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var n=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:n}})}return(eo=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(e){var t=this.s.return;return void 0===t?Promise.resolve({value:e,done:!0}):n(t.apply(this.s,arguments))},throw:function(e){var t=this.s.return;return void 0===t?Promise.reject(e):n(t.apply(this.s,arguments))}},new eo(e)}var ed=function(){var e,n=(0,C.q)(function(e){return e.address}),t=(0,ea.Z)().lookupAddress,r=(0,C.q)(function(e){return e.convoMessages}),s=(0,C.q)(function(e){return e.client}),i=(0,C.q)(function(e){return e.conversations}),a=(0,C.q)(function(e){return e.setConversations}),o=(0,C.q)(function(e){return e.addMessages}),u=(0,C.q)(function(e){return e.previewMessages}),x=(0,C.q)(function(e){return e.setPreviewMessages}),f=(0,C.q)(function(e){return e.setPreviewMessage}),m=(0,C.q)(function(e){return e.setLoadingConversations}),h=(0,v.useState)(!0),p=h[0],g=h[1];(0,v.useEffect)(function(){window.addEventListener("focus",function(){return g(!0)}),window.addEventListener("blur",function(){return g(!1)})},[]);var b=(e=(0,l.Z)(d().mark(function e(n){var t,r;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,Z.n2)(n),e.next=3,n.messages({limit:1,direction:er.SortDirection.SORT_DIRECTION_DESCENDING});case 3:if(!((r=e.sent).length<=0)){e.next=6;break}return e.abrupt("return",{key:t});case 6:return e.abrupt("return",{key:t,message:r[0]});case 7:case"end":return e.stop()}},e)})),function(n){return e.apply(this,arguments)});(0,v.useEffect)(function(){if(s){var e,h,v,g,j,w,y,N=(j=(0,l.Z)(d().mark(function e(){var i,a,l,u,x,m,h,v,g,b,j,y,N;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.conversations.streamAllMessages();case 2:w=e.sent,i=!1,a=!1,e.prev=5,u=el(w);case 7:return e.next=9,u.next();case 9:if(!(i=!(x=e.sent).done)){e.next=28;break}if(m=x.value,f(h=(0,Z.n2)(m.conversation),m),!(o(h,[m])>0)||((g=null!==(v=r.get(h))&&void 0!==v?v:[]).push(m),b=(0,ei.Z)(Array.from(new Map(g.map(function(e){return[e.id,e]})).values())),r.set(h,b),!(c!==m.id&&"granted"===Notification.permission&&m.senderAddress!==n&&!p))){e.next=25;break}return e.next=22,t(null!==(j=m.senderAddress)&&void 0!==j?j:"");case 22:N=e.sent,new Notification("XMTP",{body:"".concat(N||(0,Z.sC)(null!==(y=m.senderAddress)&&void 0!==y?y:""),"\n").concat((0,Z.$G)(m.content,75))}),c=m.id;case 25:i=!1,e.next=7;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(5),a=!0,l=e.t0;case 34:if(e.prev=34,e.prev=35,!(i&&null!=u.return)){e.next=39;break}return e.next=39,u.return();case 39:if(e.prev=39,!a){e.next=42;break}throw l;case 42:return e.finish(39);case 43:return e.finish(34);case 44:case"end":return e.stop()}},e,null,[[5,30,34,44],[35,,39,43]])})),function(){return j.apply(this,arguments)}),k=(e=(0,l.Z)(d().mark(function e(){var t,r,c,o,f;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Listing conversations"),m(!0),t=new Map(u),e.next=5,s.conversations.list();case 5:return r=e.sent,e.next=8,Promise.all(r.map(b));case 8:c=function(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return ec(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ec(e,n)}}(e))){t&&(e=t);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(c)throw i}}}}(e.sent);try{for(c.s();!(o=c.n()).done;)(f=o.value).message&&t.set(f.key,f.message)}catch(h){c.e(h)}finally{c.f()}x(t),Promise.all(r.map(function(){var e=(0,l.Z)(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.peerAddress!==n&&(i.set((0,Z.n2)(t),t),a(new Map(i)));case 1:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}())).then(function(){m(!1),"default"===Notification.permission&&Notification.requestPermission()});case 13:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)}),C=(h=(0,l.Z)(d().mark(function e(){var t,r,c,l,o,u,x;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.conversations.stream();case 2:y=e.sent,t=!1,r=!1,e.prev=5,l=el(y);case 7:return e.next=9,l.next();case 9:if(!(t=!(o=e.sent).done)){e.next=23;break}if(!((u=o.value).peerAddress!==n)){e.next=20;break}return i.set((0,Z.n2)(u),u),a(new Map(i)),e.next=16,b(u);case 16:(x=e.sent).message&&f(x.key,x.message),q(),N();case 20:t=!1,e.next=7;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(5),r=!0,c=e.t0;case 29:if(e.prev=29,e.prev=30,!(t&&null!=l.return)){e.next=34;break}return e.next=34,l.return();case 34:if(e.prev=34,!r){e.next=37;break}throw c;case 37:return e.finish(34);case 38:return e.finish(29);case 39:case"end":return e.stop()}},e,null,[[5,25,29,39],[30,,34,38]])})),function(){return h.apply(this,arguments)}),A=(v=(0,l.Z)(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,y.return();case 4:case"end":return e.stop()}},e)})),function(){return v.apply(this,arguments)}),q=(g=(0,l.Z)(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!w){e.next=3;break}return e.next=3,w.return(void 0);case 3:case"end":return e.stop()}},e)})),function(){return g.apply(this,arguments)});return k(),C(),N(),function(){A(),q()}}},[s,n])},eu=function(e){var n=e.children,t=(0,C.q)(function(e){return e.client}),r=es().initClient;ed();var s=(0,C.q)(function(e){return e.address}),i=(0,C.q)(function(e){return e.signer}),a=(0,ea.Z)(),c=a.connect,o=a.disconnect,u=(0,v.useCallback)((0,l.Z)(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o();case 2:case"end":return e.stop()}},e)})),[o]),f=(0,v.useCallback)((0,l.Z)(d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c();case 2:if(e.t0=i,!e.t0){e.next=6;break}return e.next=6,r(i);case 6:case"end":return e.stop()}},e)})),[c,r,i]);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(x(),{children:[(0,g.jsx)("title",{children:" Chat dapp"}),(0,g.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)(j,{children:s&&t?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"flex bg-zinc-50 border-b border-gray-200 md:bg-white md:border-0 max-h-16 min-h-[4rem]",children:(0,g.jsx)(w.PG,{})}),n]}):(0,g.jsx)(X,{onConnect:f})}),(0,g.jsx)(b,{children:(0,g.jsx)("aside",{className:"flex w-full md:w-84 flex-col flex-grow fixed inset-y-0",children:(0,g.jsxs)("div",{className:"flex flex-col flex-grow md:border-r md:border-gray-200 bg-white overflow-y-auto",children:[(0,g.jsxs)("div",{className:"max-h-16 min-h-[4rem]  flex items-center justify-between flex-shrink-0 px-4",children:[(0,g.jsx)(m(),{href:"/",passHref:!0,children:(0,g.jsx)("img",{className:"h-8 w-auto",src:"/icon.svg",alt:"XMTP"})}),s&&t&&(0,g.jsx)(y,{})]}),(0,g.jsx)(_,{onConnect:f}),(0,g.jsx)(et,{onConnect:f,onDisconnect:u})]})})})]})]})},ex=function(e){var n=e.children;return(0,g.jsx)(eu,{children:n})}}}]);